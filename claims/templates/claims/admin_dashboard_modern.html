{% extends 'claims/base_modern.html' %} {% load static %} {% load claims_extras
%} {% block title %}Admin Analytics - ClaimsManager{% endblock %} {% block
breadcrumb_items %}
<li>Admin Analytics</li>
{% endblock %} {% block content %}
<div class="space-y-6">
  <!-- Header Section -->
  <div
    class="hero bg-gradient-to-r from-secondary to-accent text-secondary-content rounded-lg"
  >
    <div class="hero-content text-center py-8">
      <div class="max-w-md">
        <h1 class="text-4xl font-bold">Analytics Dashboard</h1>
        <p class="py-4">Insights and metrics for claims management</p>
      </div>
    </div>
  </div>

  <!-- Key Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Total Claims -->
    <div class="stat bg-base-100 rounded-lg shadow-lg">
      <div class="stat-figure text-primary">
        <i class="fas fa-file-medical text-3xl"></i>
      </div>
      <div class="stat-title">Total Claims</div>
      <div class="stat-value text-primary">{{ total_claims }}</div>
      <div class="stat-desc">↗︎ 12% from last month</div>
    </div>

    <!-- Flagged Claims -->
    <div class="stat bg-base-100 rounded-lg shadow-lg">
      <div class="stat-figure text-warning">
        <i class="fas fa-flag text-3xl"></i>
      </div>
      <div class="stat-title">Flagged Claims</div>
      <div class="stat-value text-warning">{{ flagged_claims }}</div>
      <div class="stat-desc">{{ flag_rate|floatformat:1 }}% flag rate</div>
    </div>

    <!-- Total Notes -->
    <div class="stat bg-base-100 rounded-lg shadow-lg">
      <div class="stat-figure text-info">
        <i class="fas fa-sticky-note text-3xl"></i>
      </div>
      <div class="stat-title">Total Notes</div>
      <div class="stat-value text-info">{{ total_notes }}</div>
      <div class="stat-desc">↗︎ 8% from last week</div>
    </div>

    <!-- Active Users -->
    <div class="stat bg-base-100 rounded-lg shadow-lg">
      <div class="stat-figure text-success">
        <i class="fas fa-users text-3xl"></i>
      </div>
      <div class="stat-title">Active Users</div>
      <div class="stat-value text-success">{{ total_users }}</div>
      <div class="stat-desc">↗︎ 2 new this week</div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Status Distribution -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-chart-pie text-primary mr-2"></i>
          Claims by Status
        </h2>
        <div class="grid grid-cols-1 gap-3">
          {% for stat in status_stats %}
          <div
            class="flex items-center justify-between p-3 bg-base-200 rounded-lg"
          >
            <div class="flex items-center">
              {% if stat.status == 'Paid' %}
              <div class="w-4 h-4 bg-success rounded-full mr-3"></div>
              {% elif stat.status == 'Denied' %}
              <div class="w-4 h-4 bg-error rounded-full mr-3"></div>
              {% elif stat.status == 'Under Review' %}
              <div class="w-4 h-4 bg-warning rounded-full mr-3"></div>
              {% else %}
              <div class="w-4 h-4 bg-info rounded-full mr-3"></div>
              {% endif %}
              <span class="font-semibold">{{ stat.status }}</span>
            </div>
            <div class="text-right">
              <div class="font-bold text-lg">{{ stat.count }}</div>
              <div class="text-xs opacity-50">
                {{ stat.count|div:total_claims|mul:100|floatformat:1 }}%
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Top Insurers -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-building text-primary mr-2"></i>
          Top Insurers
        </h2>
        <div class="space-y-3">
          {% for insurer in insurer_stats|slice:":5" %}
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="avatar placeholder mr-3">
                <div
                  class="bg-neutral-focus text-neutral-content rounded-full w-8 h-8"
                >
                  <span class="text-xs">{{ insurer.insurer_name|first }}</span>
                </div>
              </div>
              <span class="font-medium">{{ insurer.insurer_name }}</span>
            </div>
            <div class="text-right">
              <div class="font-bold">{{ insurer.count }}</div>
              <div class="text-xs opacity-50">claims</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Recent Flags -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-flag text-warning mr-2"></i>
          Recent Flags
        </h2>
        {% if recent_flags %}
        <div class="space-y-3 max-h-64 overflow-y-auto">
          {% for flag in recent_flags %}
          <div class="card bg-base-200 shadow-sm">
            <div class="card-body p-4">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Claim #{{ flag.claim.id }}</div>
                  <div class="text-sm opacity-70">
                    {{ flag.claim.patient_name }}
                  </div>
                  <div class="badge badge-warning badge-sm mt-1">
                    {{ flag.reason }}
                  </div>
                </div>
                <div class="text-right text-xs opacity-50">
                  <div>{{ flag.user.username }}</div>
                  <div>{{ flag.flagged_at|timesince }} ago</div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8 opacity-50">
          <i class="fas fa-flag text-4xl mb-2"></i>
          <p>No recent flags</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- System Health -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-heartbeat text-success mr-2"></i>
          System Health
        </h2>
        <div class="space-y-4">
          <!-- Database Status -->
          <div
            class="flex items-center justify-between p-3 bg-base-200 rounded-lg"
          >
            <div class="flex items-center">
              <div class="w-3 h-3 bg-success rounded-full mr-3"></div>
              <span>Database Connection</span>
            </div>
            <div class="badge badge-success">Healthy</div>
          </div>

          <!-- API Status -->
          <div
            class="flex items-center justify-between p-3 bg-base-200 rounded-lg"
          >
            <div class="flex items-center">
              <div class="w-3 h-3 bg-success rounded-full mr-3"></div>
              <span>API Services</span>
            </div>
            <div class="badge badge-success">Online</div>
          </div>

          <!-- Storage -->
          <div
            class="flex items-center justify-between p-3 bg-base-200 rounded-lg"
          >
            <div class="flex items-center">
              <div class="w-3 h-3 bg-warning rounded-full mr-3"></div>
              <span>Storage Usage</span>
            </div>
            <div class="badge badge-warning">73% Used</div>
          </div>

          <!-- Performance -->
          <div
            class="flex items-center justify-between p-3 bg-base-200 rounded-lg"
          >
            <div class="flex items-center">
              <div class="w-3 h-3 bg-success rounded-full mr-3"></div>
              <span>Response Time</span>
            </div>
            <div class="badge badge-success">< 200ms</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Management Tools -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">
        <i class="fas fa-tools text-primary mr-2"></i>
        Management Tools
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
        <!-- Data Import -->
        <button
          class="btn btn-outline btn-lg flex-col h-24 space-y-2"
          onclick="document.getElementById('import-modal').showModal()"
        >
          <i class="fas fa-upload text-2xl"></i>
          <span>Import Claims Data</span>
        </button>

        <!-- Export Data -->
        <button
          class="btn btn-outline btn-lg flex-col h-24 space-y-2"
          onclick="document.getElementById('export-modal').showModal()"
        >
          <i class="fas fa-download text-2xl"></i>
          <span>Export Reports</span>
        </button>

        <!-- User Management -->
        <button
          class="btn btn-outline btn-lg flex-col h-24 space-y-2"
          onclick="window.open('/admin/', '_blank')"
        >
          <i class="fas fa-users-cog text-2xl"></i>
          <span>Manage Users</span>
        </button>

        <!-- System Settings -->
        <button
          class="btn btn-outline btn-lg flex-col h-24 space-y-2"
          onclick="showToast('Settings panel coming soon!', 'info')"
        >
          <i class="fas fa-cog text-2xl"></i>
          <span>System Settings</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Import Modal -->
<dialog id="import-modal" class="modal">
  <div class="modal-box">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
        ✕
      </button>
    </form>
    <h3 class="font-bold text-lg mb-4">
      <i class="fas fa-upload text-primary mr-2"></i>
      Import Claims Data
    </h3>
    <div class="space-y-4">
      <div class="form-control">
        <label class="label">
          <span class="label-text">Select CSV File</span>
        </label>
        <input
          type="file"
          class="file-input file-input-bordered file-input-primary w-full"
          accept=".csv"
        />
      </div>
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <span
          >Upload a CSV file with claims data. Make sure it follows the required
          format.</span
        >
      </div>
    </div>
    <div class="modal-action">
      <button class="btn btn-primary">
        <i class="fas fa-upload mr-2"></i>
        Import Data
      </button>
    </div>
  </div>
</dialog>

<!-- Export Modal -->
<dialog id="export-modal" class="modal">
  <div class="modal-box">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
        ✕
      </button>
    </form>
    <h3 class="font-bold text-lg mb-4">
      <i class="fas fa-download text-primary mr-2"></i>
      Export Reports
    </h3>
    <div class="space-y-4">
      <div class="form-control">
        <label class="label">
          <span class="label-text">Export Format</span>
        </label>
        <select class="select select-bordered select-primary w-full">
          <option>Excel (.xlsx)</option>
          <option>CSV (.csv)</option>
          <option>PDF Report</option>
        </select>
      </div>
      <div class="form-control">
        <label class="label">
          <span class="label-text">Date Range</span>
        </label>
        <div class="grid grid-cols-2 gap-2">
          <input
            type="date"
            class="input input-bordered input-primary"
            placeholder="From"
          />
          <input
            type="date"
            class="input input-bordered input-primary"
            placeholder="To"
          />
        </div>
      </div>
      <div class="form-control">
        <label class="cursor-pointer label">
          <span class="label-text">Include flagged claims only</span>
          <input type="checkbox" class="checkbox checkbox-primary" />
        </label>
      </div>
    </div>
    <div class="modal-action">
      <button class="btn btn-primary">
        <i class="fas fa-download mr-2"></i>
        Export Data
      </button>
    </div>
  </div>
</dialog>
{% endblock %}
